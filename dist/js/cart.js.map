{"version":3,"sources":["cart.js"],"names":["jQuery","document","ready","$","getOfferHtml","data","offerHtml","productId","quantity","unitPrice","taxAmount","discountPercent","productName","kbcode","productImg","offerDesc","calculateCartItems","count","cartPage","find","length","html","addClass","removeClass","calculateCartSummary","price","i","product","productTotal","attr","val","parseFloat","toFixed","kb_shop_currency_symbol","cartTotal","cartProducts","offerItems","on","priceEl","this","closest","total","isOfferItem","eq","productData","append","remove","isNaN","console","error","totalPrice","productHtml","self","fadeOut"],"mappings":"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","file":"cart.js","sourcesContent":["jQuery(document).ready(function($){\n  var cartPage = $('.cart-content');\n  var cartProducts = $('#cart-products-wrapper');\n  var offerItems = cartPage.find('.box-offers .offer-items');\n  /* Events */\n  $(document).on(\n    'change', \n    '.cart-content .product .counter-input input', \n    function(){\n      var priceEl = $(this).closest('.product').find('.price-value');\n      var units = parseFloat($(this).val());\n      var price = parseFloat(priceEl.attr('data-unit-price'));\n      var total = units * price;\n      total = total.toFixed(2);\n      priceEl.html(kb_shop_currency_symbol+total);\n      calculateCartSummary();\n  });\n\n  $(document).on('click', '.cart-content .product .product-delete', function(){\n    var product = $(this).closest('.product');\n    isOfferItem = product.eq(0).data('offer');\n    if(isOfferItem) {\n      var productData = {\n        unitPrice : product.eq(0).data('unit-price'),\n        taxAmount : product.eq(0).data('gst-tax-amount'),\n        discountPercent : product.eq(0).data('discount-percent'),\n        quantity : product.eq(0).data('quantity'),\n        productName : product.eq(0).data('product-name'),\n        kbcode : product.eq(0).data('kbcode'),\n        productImg : product.eq(0).data('product-img'),\n        offerDesc : product.eq(0).data('offer-desc'),\n        productId : product.eq(0).data('product-id')\n      };\n      offerHtml = getOfferHtml(productData);\n      //add back to offer items\n      offerItems.append(offerHtml);\n    }\n\n    $(this).closest('.product').remove();\n    calculateCartItems();\n    calculateCartSummary();\n  });\n\n  $(document).on('change', '.cart-content .box-section .offer-item input', function(){\n    var unitPrice = parseFloat($(this).attr('data-unit-price'));\n    var taxAmount = parseFloat($(this).attr('data-gst-tax-amount'));\n    var discountPercent = parseFloat($(this).attr('data-discount-percent'));\n    var quantity = parseFloat($(this).attr('data-quantity'));\n    if(isNaN(discountPercent) || isNaN(taxAmount) || isNaN(unitPrice) || isNaN(quantity)){\n      console.error('invalid offer item values');\n      return;\n    }\n    var totalPrice = (unitPrice * quantity).toFixed(2);\n    var productName = $(this).attr('data-product-name');\n    var kbcode = $(this).attr('data-kbcode');\n    var productImg = $(this).attr('data-product-img');\n    var offerDesc = $(this).data('offer-desc');\n    var productId = $(this).data('product-id');\n    var productHtml='';\n    productHtml += ' <div class=\"product clearfix\" data-offer=\"true\" data-offer-desc=\"'+offerDesc+'\" data-quantity=\"'+quantity+'\" data-unit-price=\"'+unitPrice+'\" data-gst-tax-amount=\"'+taxAmount+'\" data-discount-percent=\"'+discountPercent+'\" data-product-name=\"'+productName+'\" data-kbcode=\"'+kbcode+'\" data-product-img=\"'+productImg+'\" data-product-id=\"'+productId+'\">';\n    productHtml += '<div class=\"product-img\"><img src=\"'+productImg+'\"></div>';\n    productHtml += '<div class=\"product-info\"><span class=\"name\">'+productName+'</span><span class=\"kbcode\">'+kbcode+'</span></div>';\n    productHtml += '<div class=\"product-counter\">';\n    productHtml += '<div class=\"counter-input\"><span class=\"fa fa-minus decrement\"></span><span> ';\n    productHtml += '<input class=\"form-control\" type=\"number\" value=\"'+quantity+'\"></span><span class=\"fa fa-plus increment\"></span></div>';\n    productHtml += '</div>';\n    productHtml += '<div class=\"product-price\"><span class=\"price-value\" data-unit-price=\"'+unitPrice+'\">'+kb_shop_currency_symbol+totalPrice+'</span><span class=\"tax-value\" data-gst-tax-amount=\"'+taxAmount+'\">+ '+kb_shop_currency_symbol+taxAmount+' GST</span><span class=\"discount-value\" data-discount-percent=\"'+discountPercent+'\">- '+discountPercent+'%</span></div>';\n    productHtml += '<div class=\"product-delete\">';\n    productHtml += '<div><span class=\"fa fa-times\"></span></div>';\n    productHtml += '</div>';\n    productHtml += '</div>';\n    \n    var self = $(this);\n    $(this).closest('.offer-item').fadeOut('slow', 'linear', function(){\n       self.closest('.offer-item').remove();\n       cartProducts.append(productHtml);\n       calculateCartItems();\n       calculateCartSummary();\n    });\n  });\n\n  function getOfferHtml(data) {\n    if(!data)\n      return \"\";\n\n    var offerHtml='';\n    offerHtml += '<div class=\"offer-item\">';\n    offerHtml += '<div class=\"radio-wrap\">';\n    offerHtml += '<div class=\"radio radio-primary\">';\n    offerHtml += '<input id=\"offer-radio'+data.productId+'\" type=\"radio\" value=\"1\" data-quantity=\"'+data.quantity+'\" data-unit-price=\"'+data.unitPrice+'\" data-gst-tax-amount=\"'+data.taxAmount+'\" data-discount-percent=\"'+data.discountPercent+'\" data-product-name=\"'+data.productName+'\" data-kbcode=\"'+data.kbcode+'\" data-product-img=\"'+data.productImg+'\" data-product-id=\"'+data.productId+'\" data-offer-desc=\"'+data.offerDesc+'\">';\n    offerHtml += '<label for=\"offer-radio'+data.productId+'\"></label>';\n    offerHtml += '</div>';\n    offerHtml += '</div>';\n    offerHtml += '<div class=\"item-image\"><img src=\"'+data.productImg+'\"></div>';\n    offerHtml += '<div class=\"item-info\">';\n    offerHtml += '<p>'+data.offerDesc+'</p>';\n    offerHtml += '</div>';\n    offerHtml += '</div>';\n    return offerHtml;\n  }\n\n  /* functions */\n  function calculateCartItems() {\n    var count = cartPage.find('.box-products > .product').length;\n    $('#cart-item-count').html(count);\n    if(count > 0)\n      cartPage.find('.empty-cart-msg').addClass('hidden');\n    else \n      cartPage.find('.empty-cart-msg').removeClass('hidden');\n  }\n\n  function calculateCartSummary() {\n    var products = cartPage.find('.box-products > .product');\n    var count = products.length;\n    var price = 0;\n    var taxAmount = 0;\n    \n    //calculate price\n    for(var i = 1; i <= count; i++) {\n      var product = cartPage.find('.box-products > .product:nth-of-type('+i+')');\n      var productPrice = product.find('.price-value').attr('data-unit-price');\n      var quantity = product.find('.counter-input input').val();\n      var productTotal = productPrice * quantity;\n      var discountPercent = parseFloat(product.find('.discount-value').attr('data-discount-percent'));\n      if(discountPercent > 0 && discountPercent <= 100) {\n        productTotal -= ( productTotal / 100 ) * discountPercent; \n      }\n      price += parseFloat(productTotal);\n      taxAmount +=  parseFloat(product.find('.tax-value').attr('data-gst-tax-amount'));\n    }\n    \n    $('#kbprice').attr('data-price', price.toFixed(2))\n    $('#kbprice').html(kb_shop_currency_symbol+price.toFixed(2));\n\n    $('#taxAmount').attr('data-price', taxAmount.toFixed(2));\n    $('#taxAmount').html(kb_shop_currency_symbol+taxAmount.toFixed(2));\n\n    var cartTotal = (price + taxAmount).toFixed(2);\n    $('#cartTotal').attr('data-price', cartTotal);\n    $('#cartTotal').html(kb_shop_currency_symbol+cartTotal);\n  }\n\n  calculateCartItems();\n  calculateCartSummary();\n\n});\n"]}